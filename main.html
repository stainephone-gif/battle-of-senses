<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Battle of Senses</title>

  <!-- PWA Android Bridge -->
  <script src="./pwa-android-bridge.js"></script>

  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">

  <!-- Theme colors -->
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Battle of Senses">

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="./icons/icon.svg">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <!-- Microsoft Tiles -->
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="msapplication-TileImage" content="./icons/icon-144.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Space Mono', 'Courier New', monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #000000;
      color: #000;
      overflow-x: hidden;
      padding: 20px;
      animation: themeChange 8s ease-in-out infinite;
    }

    @keyframes themeChange {
      0%, 100% {
        background: #000000;
      }
      50% {
        background: #FFFFFF;
      }
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ */
    .card {
      background: #E5E5E5;
      width: 90%;
      max-width: 450px;
      padding: 50px;
      border-radius: 0px;
      text-align: center;
      opacity: 0;
      transform: scale(0.95);
      animation: fadeInScale 0.5s ease-out forwards, cardThemeChange 8s ease-in-out infinite;
      animation-delay: 0s, 0.5s;
    }

    @keyframes cardThemeChange {
      0%, 100% {
        background: #E5E5E5;
        color: #000000;
      }
      50% {
        background: #1A1A1A;
        color: #FFFFFF;
      }
    }

    @keyframes fadeInScale {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–°–¥–µ–ª–∞–π —Å–≤–æ–π –≤—ã–±–æ—Ä" */
    .title {
      font-size: 26px;
      font-weight: 700;
      color: #000000;
      margin-bottom: 35px;
      text-align: center;
      animation: textThemeChange 8s ease-in-out infinite;
      animation-delay: 0.5s;
    }

    /* –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π —Ç–µ–∫—Å—Ç */
    .description {
      font-size: 15px;
      font-weight: 400;
      color: #333333;
      line-height: 1.6;
      text-align: center;
      margin-bottom: 45px;
      animation: descriptionThemeChange 8s ease-in-out infinite;
      animation-delay: 0.5s;
    }

    /* –í–æ–ø—Ä–æ—Å */
    .question {
      font-size: 17px;
      font-weight: 600;
      color: #000000;
      text-align: center;
      margin-bottom: 25px;
      animation: textThemeChange 8s ease-in-out infinite;
      animation-delay: 0.5s;
    }

    @keyframes textThemeChange {
      0%, 100% {
        color: #000000;
      }
      50% {
        color: #FFFFFF;
      }
    }

    @keyframes descriptionThemeChange {
      0%, 100% {
        color: #333333;
      }
      50% {
        color: #CCCCCC;
      }
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .buttons {
      display: flex;
      justify-content: center;
      gap: 18px;
      flex-wrap: wrap;
    }

    /* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ */
    .choice-button {
      display: inline-block;
      width: 150px;
      height: 46px;
      background: #D0D0D0;
      color: #000000;
      font-family: 'Space Mono', 'Courier New', monospace;
      font-size: 15px;
      font-weight: 700;
      text-transform: uppercase;
      text-decoration: none;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* –ü–µ—Ä–≤–∞—è –∫–Ω–æ–ø–∫–∞ - –¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑ */
    .choice-button:nth-child(1) {
      animation: buttonFloat1 4s ease-in-out infinite, buttonThemeChange 8s ease-in-out infinite;
      animation-delay: 0.5s, 0.5s;
    }

    /* –í—Ç–æ—Ä–∞—è –∫–Ω–æ–ø–∫–∞ - –¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑-–≤–≤–µ—Ä—Ö (–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–µ) */
    .choice-button:nth-child(2) {
      animation: buttonFloat2 4s ease-in-out infinite, buttonThemeChange 8s ease-in-out infinite;
      animation-delay: 0.5s, 0.5s;
    }

    @keyframes buttonFloat1 {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-15px);
      }
    }

    @keyframes buttonFloat2 {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(15px);
      }
    }

    @keyframes buttonThemeChange {
      0%, 100% {
        background: #D0D0D0;
        color: #000000;
      }
      50% {
        background: #3A3A3A;
        color: #FFFFFF;
      }
    }

    .choice-button:hover {
      background: #A0A0A0;
    }

    .choice-button:active {
      transform: scale(0.98);
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 480px) {
      .card {
        padding: 40px 30px;
      }

      .title {
        font-size: 24px;
        margin-bottom: 30px;
      }

      .description {
        font-size: 14px;
        margin-bottom: 40px;
      }

      .question {
        font-size: 16px;
        margin-bottom: 20px;
      }

      .choice-button {
        width: 140px;
        height: 44px;
        font-size: 14px;
      }
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 360px) {
      .buttons {
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .choice-button {
        width: 100%;
        max-width: 200px;
      }
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.2s !important;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 class="title">–°–¥–µ–ª–∞–π —Å–≤–æ–π –≤—ã–±–æ—Ä</h1>

    <p class="description">
      –ú–∏—Ä –¥—Ä–µ–≤–Ω–∏—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. –ï—â–µ –ü–ª–∞—Ç–æ–Ω
      –∏ –ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å —Å—á–∏—Ç–∞–ª–∏ –¥–≤–∞ —á—É–≤—Å—Ç–≤–∞
      ¬´–±–ª–∞–≥–æ—Ä–æ–¥–Ω—ã–º–∏¬ª. –° –ø–æ—è–≤–ª–µ–Ω–∏–µ–º —Ü–∏—Ñ—Ä–æ–≤—ã—Ö
      —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –Ω–∞—à–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.
      –≠—Ç–æ –µ—Å—Ç—å —Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ —Å–≤—è–∑–∞–Ω–æ —Å —Ä–∞–∑—É–º–æ–º.
      –ù–æ –ü–ª–∞—Ç–æ–Ω —á—É–≤—Å—Ç–≤–æ –∑—Ä–µ–Ω–∏—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ
      —Å—Ç–∞–≤–∏–ª –≤—ã—à–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º
      —Å–æ —Å—Ç—Ä–∞—Å—Ç–∏ –∏–ª–∏, —Å–∫–æ—Ä–µ–µ —Å–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
      —Å–æ —Å—Ç—Ä–∞—à–Ω–æ–π –±–æ–ª–∏ –∏ –ø—É—Å—Ç–æ—Ç—ã.
    </p>

    <h2 class="question">–ö–∞–∫–æ–µ —á—É–≤—Å—Ç–≤–æ –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω–µ–µ?</h2>

    <div class="buttons">
      <a href="zrenie_mob.html" class="choice-button">–ó—Ä–µ–Ω–∏–µ</a>
      <a href="sluh.html" class="choice-button" id="soundBtn">–°–ª—É—Ö</a>
    </div>
  </div>

  <script>
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    const preloadLinks = ['zrenie_mob.html', 'sluh.html'];
    preloadLinks.forEach(href => {
      const link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = href;
      document.head.appendChild(link);
    });

    // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –£–ú–ù–´–ú –û–°–í–ï–©–ï–ù–ò–ï–ú ==========

    let lightsConfig = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Å–≤–µ—â–µ–Ω–∏—è
    function loadLightsConfig() {
      const saved = localStorage.getItem('lights_config');
      if (saved) {
        try {
          lightsConfig = JSON.parse(saved);
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–≤–µ—Ç–∞:', e);
        }
      }
    }

    // –í—ã–∫–ª—é—á–µ–Ω–∏–µ —Å–≤–µ—Ç–∞ (Philips Hue)
    async function turnOffLights() {
      if (!lightsConfig || lightsConfig.type !== 'hue') return;

      try {
        const response = await fetch(`http://${lightsConfig.ip}/api/${lightsConfig.apiKey}/lights`);
        if (!response.ok) return;

        const lights = await response.json();
        const lightIds = Object.keys(lights);

        // –í—ã–∫–ª—é—á–∞–µ–º –≤—Å–µ –ª–∞–º–ø—ã
        for (const id of lightIds) {
          await fetch(`http://${lightsConfig.ip}/api/${lightsConfig.apiKey}/lights/${id}/state`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ on: false })
          });
        }

        console.log('üí° –°–≤–µ—Ç –≤—ã–∫–ª—é—á–µ–Ω');

        // –í–∏–±—Ä–∞—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
        if (typeof Android !== 'undefined') {
          Android.vibrate(200);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–≤–µ—Ç–∞:', error);
      }
    }

    // –í–∫–ª—é—á–µ–Ω–∏–µ —Å–≤–µ—Ç–∞ (Philips Hue)
    async function turnOnLights() {
      if (!lightsConfig || lightsConfig.type !== 'hue') return;

      try {
        const response = await fetch(`http://${lightsConfig.ip}/api/${lightsConfig.apiKey}/lights`);
        if (!response.ok) return;

        const lights = await response.json();
        const lightIds = Object.keys(lights);

        // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –ª–∞–º–ø—ã
        for (const id of lightIds) {
          await fetch(`http://${lightsConfig.ip}/api/${lightsConfig.apiKey}/lights/${id}/state`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ on: true, bri: 254 }) // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —è—Ä–∫–æ—Å—Ç—å
          });
        }

        console.log('üí° –°–≤–µ—Ç –≤–∫–ª—é—á–µ–Ω');

        // –í–∏–±—Ä–∞—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
        if (typeof Android !== 'undefined') {
          Android.vibrate(100);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è —Å–≤–µ—Ç–∞:', error);
      }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadLightsConfig();

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°–ª—É—Ö" - –≤—ã–∫–ª—é—á–∞–µ–º —Å–≤–µ—Ç
    const soundBtn = document.getElementById('soundBtn');
    if (soundBtn) {
      soundBtn.addEventListener('click', async (e) => {
        if (lightsConfig) {
          e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥

          console.log('üéµ –ö–Ω–æ–ø–∫–∞ "–°–ª—É—Ö" –Ω–∞–∂–∞—Ç–∞, –≤—ã–∫–ª—é—á–∞–µ–º —Å–≤–µ—Ç...');
          await turnOffLights();

          // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∏—è
          setTimeout(() => {
            window.location.href = 'sluh.html';
          }, 500);
        }
        // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ
      });
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
    if ('vibrate' in navigator) {
      document.querySelectorAll('.choice-button').forEach(button => {
        button.addEventListener('click', () => {
          navigator.vibrate(10); // 10ms –≤–∏–±—Ä–∞—Ü–∏—è
        });
      });
    }

    // PWA: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => {
            console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
              registration.update();
            }, 60000);
          })
          .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
          });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Service Worker
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('üîÑ Service Worker –æ–±–Ω–æ–≤–ª–µ–Ω, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...');
          window.location.reload();
        });
      });
    }
  </script>
</body>
</html>
