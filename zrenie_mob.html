<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Зрение — Battle of Senses</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ================================================
       БАЗОВЫЕ СТИЛИ
       ================================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: 'Space Mono', 'Courier New', monospace;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* ================================================
       КОНТЕЙНЕР ЭКРАНОВ
       ================================================ */
    #screens-container {
      height: 100vh;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }

    /* ================================================
       НАВИГАЦИЯ
       ================================================ */
    .nav-home {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: #fff;
      font-size: 24px;
      z-index: 10000;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .nav-home:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: scale(1.1);
    }

    /* Индикатор экранов */
    .screen-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 9999;
    }

    .screen-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .screen-dot.active {
      background: rgba(255, 255, 255, 0.9);
      transform: scale(1.3);
    }

    /* ================================================
       ЭКРАН 1: ФИЛОСОФЫ
       ================================================ */
    #screen1 {
      background: linear-gradient(135deg, #E8E5E0 0%, #F5F2ED 50%, #E5E5DD 100%);
    }

    .philosophers-container {
      position: relative;
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }

    .philosopher {
      position: absolute;
      cursor: pointer;
      transition: transform 0.3s ease, left 0.6s ease, top 0.6s ease;
    }

    .philosopher:hover {
      transform: scale(1.05);
      z-index: 10;
    }

    .philosopher-image {
      width: 200px;
      height: 200px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      transition: all 0.5s ease;
    }

    .philosopher-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: blur(15px) brightness(0.7);
      transition: filter 0.6s ease;
    }

    .philosopher.revealed .philosopher-image img {
      filter: blur(0px) brightness(1) !important;
    }

    .philosopher.revealed .philosopher-image {
      box-shadow: 0 12px 36px rgba(229, 229, 221, 0.4);
    }

    .philosopher-text {
      margin-top: 15px;
      padding: 15px 20px;
      background: rgba(229, 229, 221, 0.95);
      border-radius: 8px;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.5s ease;
      pointer-events: none;
      max-width: 250px;
    }

    .philosopher.revealed .philosopher-text {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .philosopher-text h3 {
      font-size: 18px;
      font-weight: 700;
      color: #000000;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .philosopher-text p {
      font-size: 13px;
      font-weight: 400;
      color: #333333;
      line-height: 1.5;
      margin: 0;
    }

    @media (max-width: 480px) {
      .philosopher-image {
        width: 150px;
        height: 150px;
      }

      .philosopher-text {
        max-width: 200px;
        padding: 12px 15px;
      }

      .philosopher-text h3 {
        font-size: 16px;
      }

      .philosopher-text p {
        font-size: 12px;
      }
    }

    /* ================================================
       ЭКРАН 2: АРТ-ПЕСОЧНИЦА
       ================================================ */
    #screen2 {
      background: linear-gradient(to bottom, #f6d365, #fda085);
    }

    .shape {
      position: absolute;
      left: 0;
      top: 0;
      transform: translate(-50%,-50%) rotate(var(--rotation,0deg)) scale(0);
      will-change: transform, opacity;
      pointer-events: none;
      opacity: 0.95;
      transition: opacity 1s ease, transform 0.9s ease;
      z-index: 1;
    }

    @keyframes pop {
      from { transform: translate(-50%,-50%) rotate(var(--rotation,0deg)) scale(0); opacity:0; }
      to   { transform: translate(-50%,-50%) rotate(var(--rotation,0deg)) scale(1); opacity:0.95; }
    }

    .pop {
      animation: pop 220ms cubic-bezier(.2,.8,.2,1) forwards;
    }

    .fade-out {
      opacity: 0;
      transform: translate(-50%,-50%) rotate(var(--rotation,0deg)) scale(0.4);
    }

    img.shape {
      object-fit: cover;
      border-radius: 12px;
      display:block;
    }

    .hint {
      position: fixed;
      top: 80px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      color: #fff;
      padding: 12px 20px;
      border-radius: 24px;
      font-size: 13px;
      backdrop-filter: blur(10px);
      z-index: 9998;
      letter-spacing: 0.5px;
      border: 1px solid rgba(255,255,255,0.3);
      font-weight: 400;
      text-align: center;
      max-width: 200px;
    }

    /* ================================================
       ЭКРАН 3: ГИПЕРТЕКСТ-ЛОВУШКА
       ================================================ */
    #screen3 {
      background: linear-gradient(135deg,#ff3cac,#784ba0,#2b86c5,#ffcc70,#ff8177);
      background-size: 500% 500%;
      animation: bgshift 10s ease infinite;
      color: white;
      text-align: center;
    }

    @keyframes bgshift {
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .btn {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      padding: 20px 35px;
      background: #fff;
      color: #000;
      border-radius: 20px;
      font-size: 26px;
      font-weight: 900;
      cursor: pointer;
      box-shadow: 0 0 25px #fff, 0 0 50px #ff00ff;
      animation: blink 1s infinite;
      z-index: 10;
      border: none;
      font-family: 'Space Mono', 'Courier New', monospace;
    }

    @keyframes blink {
      0%,100% {opacity:1; transform:translate(-50%,-50%) scale(1);}
      50% {opacity:0.3; transform:translate(-50%,-50%) scale(1.1);}
    }

    .message {
      position: absolute;
      top: 20%; left: 50%;
      transform: translateX(-50%);
      font-size: 22px;
      font-weight: 700;
      text-shadow: 0 0 10px #000;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 9;
    }

    .garbage, .text-frag {
      position: absolute;
      animation: fall 6s linear forwards;
      z-index: 2;
    }

    .garbage img {
      border-radius: 10px;
    }

    .text-frag {
      color: #fff;
      font-weight: 600;
      text-shadow: 0 0 10px #000;
    }

    @keyframes fall {
      from {transform:translateY(-10vh) rotate(0);}
      to {transform:translateY(120vh) rotate(360deg);}
    }

    #philosopherOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
      display: none;
    }

    #philosopherOverlay img {
      max-width: 60%;
      max-height: 60%;
      margin-bottom: 20px;
      border-radius: 15px;
      transition: opacity 0.3s ease;
      opacity: 0;
    }

    #philosopherOverlay img.active {
      opacity: 1;
    }

    #quote {
      color: white;
      font-size: 28px;
      font-weight: 700;
      text-align: center;
      max-width: 80%;
      line-height: 1.4;
    }

    /* ================================================
       ЭКРАН 4: СЕНСОРНЫЙ ПОВОРОТ
       ================================================ */
    #screen4 {
      background: linear-gradient(120deg, #ff6ec4, #7873f5, #00f2fe, #ff9a9e);
      background-size: 600% 600%;
      animation: gradientShift 12s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    @keyframes gradientShift {
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    /* яркие частицы */
    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: rgba(255,255,255,0.9);
      border-radius: 50%;
      box-shadow: 0 0 15px rgba(255,255,255,0.8), 0 0 30px rgba(255,255,255,0.6);
      animation: floatParticle 14s linear infinite;
      z-index: 1;
    }

    @keyframes floatParticle {
      from { transform: translateY(110vh) scale(0.4); opacity: 0; }
      20% { opacity: 1; }
      to { transform: translateY(-20vh) scale(1.4); opacity: 0; }
    }

    /* контейнер текста */
    .text-wrapper {
      position: relative;
      width: 80%;
      max-width: 340px;
      height: 100%;
      overflow: hidden;
      text-align: center;
      z-index: 2;
    }

    .text-blurred, .text-readable {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      line-height: 1.8;
      font-size: 20px;
      font-weight: 600;
      white-space: pre-line;
      animation: scrollText 70s linear infinite;
    }

    @keyframes scrollText {
      0% { transform: translate(-50%, 0); }
      100% { transform: translate(-50%, -100%); }
    }

    .text-blurred {
      color: transparent;
      text-shadow: 0 0 6px rgba(0,0,0,0.8);
      filter: blur(4px) contrast(200%);
    }

    /* проявляющая маска */
    .mask {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      -webkit-mask-image: radial-gradient(circle, rgba(0,0,0,1) 75%, transparent 100%);
      -webkit-mask-repeat: no-repeat;
      -webkit-mask-position: center 50%;
      -webkit-mask-size: 100% 30%;
      mask-image: radial-gradient(circle, rgba(0,0,0,1) 75%, transparent 100%);
      mask-repeat: no-repeat;
      mask-position: center 50%;
      mask-size: 100% 30%;
      filter: drop-shadow(0 0 25px rgba(255,255,255,0.9));
      transition: -webkit-mask-position 0.1s ease, mask-position 0.1s ease;
    }

    .text-readable {
      color: #fff;
      text-shadow: 0 0 10px rgba(0,0,0,0.6);
    }

    /* декоративные кольца */
    .ring {
      position: absolute;
      border: 2px solid rgba(255,255,255,0.5);
      border-radius: 50%;
      animation: pulseRing 10s linear infinite;
      z-index: 1;
    }

    @keyframes pulseRing {
      0% { transform: scale(0.8); opacity: 0.8; }
      50% { transform: scale(1.3); opacity: 0.2; }
      100% { transform: scale(0.8); opacity: 0.8; }
    }

    @media (max-width: 480px) {
      .text-wrapper {
        max-width: 300px;
      }

      .text-blurred, .text-readable {
        font-size: 16px;
      }
    }

    /* ================================================
       ФИНАЛЬНАЯ КНОПКА
       ================================================ */
    .finish-btn {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      padding: 18px 45px;
      background: rgba(255, 255, 255, 0.25);
      color: #fff;
      text-decoration: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
      border: 2px solid rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(15px);
      transition: all 0.3s ease;
      z-index: 9999;
      font-family: 'Space Mono', 'Courier New', monospace;
      display: none;
    }

    .finish-btn.visible {
      display: block;
    }

    .finish-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateX(-50%) scale(1.05);
    }

    /* ================================================
       АДАПТИВНОСТЬ
       ================================================ */
    @media (max-width: 480px) {
      .hint {
        top: auto;
        bottom: 100px;
        right: 50%;
        transform: translateX(50%);
        max-width: calc(100% - 40px);
        font-size: 12px;
        padding: 10px 16px;
      }

      .finish-btn {
        padding: 16px 35px;
        font-size: 14px;
        bottom: 20px;
      }

      .nav-home {
        width: 44px;
        height: 44px;
        font-size: 22px;
      }

      #quote {
        font-size: 20px;
      }
    }

    /* ================================================
       ДОСТУПНОСТЬ
       ================================================ */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.2s !important;
      }
    }
  </style>
</head>
<body>
  <a href="index.html" class="nav-home" aria-label="Вернуться на главную">⌂</a>

  <!-- Индикатор экранов -->
  <div class="screen-indicator">
    <div class="screen-dot active"></div>
    <div class="screen-dot"></div>
    <div class="screen-dot"></div>
    <div class="screen-dot"></div>
  </div>

  <!-- Контейнер экранов -->
  <div id="screens-container">
    <!-- ЭКРАН 1: ФИЛОСОФЫ -->
    <div class="screen" id="screen1" data-screen="0">
      <div class="philosophers-container">
        <div class="philosopher" data-philosopher="plato">
          <div class="philosopher-image">
            <img src="pic/Plato.png" alt="Платон" loading="lazy">
          </div>
          <div class="philosopher-text">
            <h3>Платон</h3>
            <p>Зрение — важнейшее из чувств, через него познаётся истина и красота идей.</p>
          </div>
        </div>

        <div class="philosopher" data-philosopher="aristotle">
          <div class="philosopher-image">
            <img src="pic/Arist.png" alt="Аристотель" loading="lazy">
          </div>
          <div class="philosopher-text">
            <h3>Аристотель</h3>
            <p>Видение даёт наибольшее знание о мире, открывая различия между вещами.</p>
          </div>
        </div>

        <div class="philosopher" data-philosopher="pythagoras">
          <div class="philosopher-image">
            <img src="pic/Piph.png" alt="Пифагор" loading="lazy">
          </div>
          <div class="philosopher-text">
            <h3>Пифагор</h3>
            <p>Через созерцание геометрических форм разум постигает гармонию космоса.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ЭКРАН 2: АРТ-ПЕСОЧНИЦА -->
    <div class="screen" id="screen2" data-screen="1">
      <div class="hint">Рисуйте касанием или кликом</div>
    </div>

    <!-- ЭКРАН 3: ГИПЕРТЕКСТ-ЛОВУШКА -->
    <div class="screen" id="screen3" data-screen="2">
      <div class="btn" id="startBtn">НЕ НАЖИМАЙ СЮДА</div>

      <div id="philosopherOverlay">
        <img id="philo1" src="pic/Arist.png">
        <img id="philo2" src="pic/Plato.png">
        <img id="philo3" src="pic/Piph.png">
        <div id="quote"></div>
      </div>
    </div>

    <!-- ЭКРАН 4: СЕНСОРНЫЙ ПОВОРОТ -->
    <div class="screen" id="screen4" data-screen="3">
      <!-- кольца -->
      <div class="ring" style="width:200px;height:200px;top:10%;left:10%;"></div>
      <div class="ring" style="width:300px;height:300px;bottom:15%;right:15%;animation-delay:3s;"></div>

      <div class="text-wrapper">
        <!-- размытый текст -->
        <div class="text-blurred">На представленной выставке "Благородные чувства" авторы исследуют роль зрения и слуха в восприятии и познании мира. Ищут новые подходы в оптическом и акустическом, в попытке опровергнуть или подтвердить доводы о "благородных чувствах и ощущениях", тезис, который опирается на античную и современную философию и подтверждается человеческим бытованием вплоть до 21 го века. Так ли благородны эти чувства, может ли раскрыться их потенциал в новой технологической реальности? На выставке представлены видео и саунд-арт, интерактивные инсталляции, оп-арт, фотография, скульптура и документация перформанса, тексты. Участники проекта: художники, ученые, инноваторы и философы

На представленной выставке "Благородные чувства" авторы исследуют роль зрения и слуха в восприятии и познании мира. Ищут новые подходы в оптическом и акустическом, в попытке опровергнуть или подтвердить доводы о "благородных чувствах и ощущениях", тезис, который опирается на античную и современную философию и подтверждается человеческим бытованием вплоть до 21 го века. Так ли благородны эти чувства, может ли раскрыться их потенциал в новой технологической реальности? На выставке представлены видео и саунд-арт, интерактивные инсталляции, оп-арт, фотография, скульптура и документация перформанса, тексты. Участники проекта: художники, ученые, инноваторы и философы</div>

        <!-- читаемый текст через маску -->
        <div class="mask">
          <div class="text-readable">На представленной выставке "Благородные чувства" авторы исследуют роль зрения и слуха в восприятии и познании мира. Ищут новые подходы в оптическом и акустическом, в попытке опровергнуть или подтвердить доводы о "благородных чувствах и ощущениях", тезис, который опирается на античную и современную философию и подтверждается человеческим бытованием вплоть до 21 го века. Так ли благородны эти чувства, может ли раскрыться их потенциал в новой технологической реальности? На выставке представлены видео и саунд-арт, интерактивные инсталляции, оп-арт, фотография, скульптура и документация перформанса, тексты. Участники проекта: художники, ученые, инноваторы и философы

На представленной выставке "Благородные чувства" авторы исследуют роль зрения и слуха в восприятии и познании мира. Ищут новые подходы в оптическом и акустическом, в попытке опровергнуть или подтвердить доводы о "благородных чувствах и ощущениях", тезис, который опирается на античную и современную философию и подтверждается человеческим бытованием вплоть до 21 го века. Так ли благородны эти чувства, может ли раскрыться их потенциал в новой технологической реальности? На выставке представлены видео и саунд-арт, интерактивные инсталляции, оп-арт, фотография, скульптура и документация перформанса, тексты. Участники проекта: художники, ученые, инноваторы и философы</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Финальная кнопка -->
  <a href="quiet.html" class="finish-btn" id="finishBtn">Войти в тишину</a>

  <script>
    // ================================================
    // СИСТЕМА НАВИГАЦИИ МЕЖДУ ЭКРАНАМИ
    // ================================================
    let currentScreen = 0;
    const totalScreens = 4;
    const screensContainer = document.getElementById('screens-container');
    const screens = document.querySelectorAll('.screen');
    const dots = document.querySelectorAll('.screen-dot');
    const finishBtn = document.getElementById('finishBtn');

    let touchStartY = 0;
    let touchEndY = 0;
    let isTransitioning = false;

    function updateScreens() {
      screens.forEach((screen, index) => {
        const offset = (index - currentScreen) * 100;
        screen.style.transform = `translateY(${offset}%)`;
      });

      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentScreen);
      });

      // Показываем финальную кнопку на последнем экране
      if (currentScreen === totalScreens - 1) {
        finishBtn.classList.add('visible');
      } else {
        finishBtn.classList.remove('visible');
      }
    }

    function goToScreen(screenIndex) {
      if (isTransitioning) return;
      if (screenIndex < 0 || screenIndex >= totalScreens) return;

      isTransitioning = true;
      currentScreen = screenIndex;
      updateScreens();

      setTimeout(() => {
        isTransitioning = false;
      }, 500);
    }

    // Touch события для свайпов
    document.addEventListener('touchstart', (e) => {
      touchStartY = e.changedTouches[0].screenY;
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      touchEndY = e.changedTouches[0].screenY;
      handleSwipe();
    }, { passive: true });

    function handleSwipe() {
      const diff = touchStartY - touchEndY;
      const threshold = 50;

      if (Math.abs(diff) > threshold) {
        if (diff > 0) {
          // Свайп вверх - следующий экран
          goToScreen(currentScreen + 1);
        } else {
          // Свайп вниз - предыдущий экран
          goToScreen(currentScreen - 1);
        }
      }
    }

    // Клавиатура для тестирования
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown') goToScreen(currentScreen + 1);
      if (e.key === 'ArrowUp') goToScreen(currentScreen - 1);
    });

    // Инициализация
    updateScreens();

    // ================================================
    // ЭКРАН 1: ФИЛОСОФЫ
    // ================================================
    function positionPhilosophers() {
      const container = document.querySelector('.philosophers-container');
      const philosophers = document.querySelectorAll('.philosopher');

      if (!container || philosophers.length === 0) return;

      const containerWidth = container.clientWidth;
      const containerHeight = container.clientHeight;
      const positions = [];
      const isMobile = window.innerWidth < 768;

      function checkOverlap(rect1, rect2) {
        return !(rect1.right < rect2.left ||
                 rect1.left > rect2.right ||
                 rect1.bottom < rect2.top ||
                 rect1.top > rect2.bottom);
      }

      philosophers.forEach((philosopher, index) => {
        const imageWidth = philosopher.querySelector('.philosopher-image').offsetWidth;
        const imageHeight = philosopher.querySelector('.philosopher-image').offsetHeight;
        const textHeight = 100;
        const totalHeight = imageHeight + textHeight;

        let attempts = 0;
        let positioned = false;

        while (!positioned && attempts < 100) {
          attempts++;

          let x, y;

          if (isMobile) {
            x = Math.random() * (containerWidth * 1.4) - (imageWidth * 0.4);
            y = Math.random() * (containerHeight * 0.7) + (containerHeight * 0.05);
            x = Math.max(-(imageWidth * 0.4), Math.min(x, containerWidth - (imageWidth * 0.6)));
          } else {
            x = Math.random() * (containerWidth * 1.4) - (containerWidth * 0.3);
            y = Math.random() * (containerHeight * 0.75) + (containerHeight * 0.05);
          }

          const newRect = {
            left: x,
            top: y,
            right: x + imageWidth,
            bottom: y + totalHeight
          };

          let hasOverlap = false;
          for (let pos of positions) {
            if (checkOverlap(newRect, pos)) {
              hasOverlap = true;
              break;
            }
          }

          if (!hasOverlap) {
            philosopher.style.left = `${x}px`;
            philosopher.style.top = `${y}px`;
            positions.push(newRect);
            positioned = true;
          }
        }

        if (!positioned) {
          const fallbackPositions = [
            { x: containerWidth * 0.1, y: containerHeight * 0.15 },
            { x: containerWidth * 0.5, y: containerHeight * 0.45 },
            { x: containerWidth * 0.7, y: containerHeight * 0.25 }
          ];
          const fallback = fallbackPositions[index] || fallbackPositions[0];
          philosopher.style.left = `${fallback.x}px`;
          philosopher.style.top = `${fallback.y}px`;
        }
      });
    }

    window.addEventListener('load', positionPhilosophers);
    window.addEventListener('resize', positionPhilosophers);

    document.querySelectorAll('.philosopher').forEach(philosopher => {
      philosopher.addEventListener('click', function(e) {
        this.classList.add('revealed');
        const img = this.querySelector('.philosopher-image img');
        img.style.filter = '';

        if ('vibrate' in navigator) {
          navigator.vibrate(20);
        }

        e.stopPropagation();
      });

      philosopher.addEventListener('mouseenter', function() {
        if (!this.classList.contains('revealed')) {
          const img = this.querySelector('.philosopher-image img');
          img.style.filter = 'blur(12px) brightness(0.8)';
        }
      });

      philosopher.addEventListener('mouseleave', function() {
        if (!this.classList.contains('revealed')) {
          const img = this.querySelector('.philosopher-image img');
          img.style.filter = 'blur(15px) brightness(0.7)';
        }
      });
    });

    // ================================================
    // ЭКРАН 2: АРТ-ПЕСОЧНИЦА
    // ================================================
    const CLEAR_DELAY = 5000;
    const MIN_SIZE = 30;
    const MAX_SIZE = 140;
    const MOVE_THROTTLE_MS = 40;
    const MOVE_MIN_DIST = 8;

    const images = ["pic/Plato.png", "pic/Arist.png", "pic/Piph.png"];

    let clearTimer = null;
    let isDrawing = false;
    let lastMoveTime = 0;
    let lastPos = { x: -9999, y: -9999 };

    function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
    function randColor(){ return `hsl(${randInt(0,360)}, ${randInt(60,100)}%, ${randInt(40,65)}%)`; }
    function randGradient(){
      const a = randColor();
      const b = randColor();
      const ang = randInt(0,360);
      return `linear-gradient(${ang}deg, ${a}, ${b})`;
    }

    function scheduleClear(){
      if (clearTimer) clearTimeout(clearTimer);
      clearTimer = setTimeout(()=> {
        const all = document.querySelectorAll('.shape');
        all.forEach(el => {
          el.classList.add('fade-out');
          setTimeout(()=> el.remove(), 1000);
        });
      }, CLEAR_DELAY);
    }

    function createShapeAt(x,y){
      const useImage = Math.random() > 0.5 && images.length>0;
      const el = useImage ? document.createElement('img') : document.createElement('div');
      el.classList.add('shape');

      const size = randInt(MIN_SIZE, MAX_SIZE);
      el.style.width = size + 'px';
      el.style.height = size + 'px';

      const rotationDeg = randInt(0,360) + 'deg';
      el.style.setProperty('--rotation', rotationDeg);

      el.style.left = x + 'px';
      el.style.top = y + 'px';

      if (useImage){
        el.src = images[randInt(0, images.length-1)];
        el.style.objectFit = 'cover';
      } else {
        const shapeKind = randInt(1,5);
        if (shapeKind === 1) el.style.borderRadius = '50%';
        else if (shapeKind === 2) el.style.borderRadius = '6px';
        else if (shapeKind === 3) el.style.clipPath = 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)';
        else if (shapeKind === 4) el.style.borderRadius = '18%';
        else el.style.borderRadius = '0';

        if (Math.random() > 0.35) el.style.background = randGradient();
        else el.style.background = randColor();
      }

      document.getElementById('screen2').appendChild(el);
      requestAnimationFrame(()=> {
        el.classList.add('pop');
      });

      setTimeout(()=>{
        if (el.parentElement) {
          el.classList.add('fade-out');
          setTimeout(()=> el.remove(), 1000);
        }
      }, CLEAR_DELAY + 2000);

      scheduleClear();
      return el;
    }

    function handlePointerDown(e){
      if (currentScreen !== 1) return; // Только на экране 2
      if (e.cancelable) e.preventDefault();

      isDrawing = true;
      lastMoveTime = 0;
      lastPos.x = -9999; lastPos.y = -9999;
      const {x,y} = getXY(e);
      createShapeAt(x,y);
      scheduleClear();

      if ('vibrate' in navigator) {
        navigator.vibrate(10);
      }
    }

    function handlePointerMove(e){
      if (!isDrawing || currentScreen !== 1) return;
      const now = performance.now();
      if (now - lastMoveTime < MOVE_THROTTLE_MS) return;

      const {x,y} = getXY(e);
      const dx = x - lastPos.x;
      const dy = y - lastPos.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < MOVE_MIN_DIST) return;

      lastMoveTime = now;
      lastPos.x = x; lastPos.y = y;
      createShapeAt(x,y);
    }

    function handlePointerUp(e){
      isDrawing = false;
    }

    function getXY(e){
      if ('clientX' in e && 'clientY' in e){
        return { x: e.clientX, y: e.clientY };
      }
      if (e.touches && e.touches[0]){
        return { x: e.touches[0].clientX, y: e.touches[0].clientY };
      }
      if (e.changedTouches && e.changedTouches[0]){
        return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
      }
      return { x: window.innerWidth/2, y: window.innerHeight/2 };
    }

    if (window.PointerEvent){
      document.addEventListener('pointerdown', handlePointerDown, {passive:false});
      document.addEventListener('pointermove', handlePointerMove, {passive:false});
      document.addEventListener('pointerup', handlePointerUp, {passive:true});
      document.addEventListener('pointercancel', handlePointerUp, {passive:true});
    } else {
      document.addEventListener('touchstart', (e)=>{ if (e.cancelable) e.preventDefault(); handlePointerDown(e); }, {passive:false});
      document.addEventListener('touchmove', (e)=>{ if (e.cancelable) e.preventDefault(); handlePointerMove(e); }, {passive:false});
      document.addEventListener('touchend', handlePointerUp, {passive:true});
      document.addEventListener('mousedown', (e)=>{ handlePointerDown(e); }, {passive:false});
      document.addEventListener('mousemove', (e)=>{ handlePointerMove(e); }, {passive:true});
      document.addEventListener('mouseup', handlePointerUp, {passive:true});
    }

    // ================================================
    // ЭКРАН 3: ГИПЕРТЕКСТ-ЛОВУШКА
    // ================================================
    const btn = document.getElementById('startBtn');
    const warnings = ["Серьёзно, прекрати!","Это тебе не нужно","Ты правда хочешь это?","Ещё раз и назад дороги не будет","Стоп!"];
    const texts = ["Благородные чувства…","Зрение — солнце души","Слух — проводник гармонии","Пифагор: музыка — математика мира","Познание идей через зрение","21 век: технологии и чувства","Искусство, наука, философия","Гармония света и звука"];
    const philosophers = [
      {name:'aristotel', src:'pic/Arist.png', quote:'«Счастье заключается в деятельности разума, согласной с добродетелью»'},
      {name:'platon', src:'pic/Plato.png', quote:'«Идеи — это вечные образы всего сущего»'},
      {name:'pifagor', src:'pic/Piph.png', quote:'«Все есть число»'}
    ];

    let clickCount = 0, chaosInterval, slideshowInterval, activeIndex=0;
    const overlay = document.getElementById('philosopherOverlay');
    const imagesArr = [document.getElementById('philo1'),document.getElementById('philo2'),document.getElementById('philo3')];

    btn.addEventListener('click',()=>{
      if(clickCount<warnings.length){
        showMessage(warnings[clickCount]);
        clickCount++;
      } else {
        spawnChaos();
      }
    });

    function showMessage(text){
      const msg=document.createElement('div');
      msg.className='message';
      msg.textContent=text;
      document.getElementById('screen3').appendChild(msg);
      setTimeout(()=>{ msg.style.opacity=1; },10);
      setTimeout(()=>msg.remove(),3000);
    }

    function spawnChaos(){
      btn.style.display='none';
      chaosInterval = setInterval(()=>{
        if(Math.random()>0.5){
          const g=document.createElement('div');
          g.className='garbage';
          g.style.left=Math.random()*90+'%';
          g.style.top='-10vh';
          const img=document.createElement('img');
          img.src=images[Math.floor(Math.random()*images.length)];
          const size=40+Math.random()*60;
          img.style.width=size+'px';
          img.style.height=size+'px';
          g.appendChild(img);
          document.getElementById('screen3').appendChild(g);
          setTimeout(()=>g.remove(),6000);
        } else {
          const t=document.createElement('div');
          t.className='text-frag';
          t.textContent=texts[Math.floor(Math.random()*texts.length)];
          t.style.fontSize=(16+Math.random()*14)+'px';
          t.style.left=Math.random()*80+'%';
          t.style.top='-10vh';
          t.style.animationDuration=(3+Math.random()*3)+'s';
          document.getElementById('screen3').appendChild(t);
          setTimeout(()=>t.remove(),6000);
        }
      },500);

      setTimeout(()=>{
        startSlideshow();
      },10000);
    }

    function startSlideshow(){
      overlay.style.display='flex';
      let lastIndex=-1;

      slideshowInterval=setInterval(()=>{
        let idx;
        do { idx=Math.floor(Math.random()*3); } while(idx===lastIndex);
        imagesArr.forEach(img => img.classList.remove('active'));
        imagesArr[idx].classList.add('active');
        lastIndex = idx;
        activeIndex = idx;
      }, 150);

      overlay.addEventListener('click', fixSlide);
    }

    function fixSlide(){
      clearInterval(slideshowInterval);
      imagesArr.forEach(img => img.classList.remove('active'));
      imagesArr[activeIndex].classList.add('active');
      const name = ['aristotel','platon','pifagor'][activeIndex];
      document.getElementById('quote').textContent = philosophers.find(p => p.name === name).quote;
      overlay.removeEventListener('click', fixSlide);
    }

    // Вибрация для финальной кнопки
    finishBtn.addEventListener('click', () => {
      if ('vibrate' in navigator) {
        navigator.vibrate(15);
      }
    });

    // ================================================
    // ЭКРАН 4: СЕНСОРНЫЙ ПОВОРОТ
    // ================================================

    // Генерация частиц
    const screen4 = document.getElementById('screen4');
    for(let i = 0; i < 35; i++){
      const p = document.createElement('div');
      p.className = 'particle';
      p.style.left = Math.random() * 100 + '%';
      p.style.animationDelay = (Math.random() * 14) + 's';
      screen4.appendChild(p);
    }

    // Управление маской через прикосновение к экрану
    const mask = document.querySelector('.mask');
    let isTouching = false;

    function setMaskPosition(clientY){
      if (!mask) return;

      const screenHeight = window.innerHeight;
      let pos = (clientY / screenHeight) * 100;

      // Ограничиваем позицию
      if (pos < 0) pos = 0;
      if (pos > 100) pos = 100;

      mask.style.webkitMaskPosition = `center ${pos}%`;
      mask.style.maskPosition = `center ${pos}%`;
    }

    // Touch события для экрана 4
    screen4.addEventListener('touchstart', (e) => {
      if (currentScreen !== 3) return;
      isTouching = true;
      const touch = e.touches[0];
      setMaskPosition(touch.clientY);

      if ('vibrate' in navigator) {
        navigator.vibrate(10);
      }
    }, {passive: true});

    screen4.addEventListener('touchmove', (e) => {
      if (currentScreen !== 3 || !isTouching) return;
      const touch = e.touches[0];
      setMaskPosition(touch.clientY);
    }, {passive: true});

    screen4.addEventListener('touchend', () => {
      isTouching = false;
    }, {passive: true});

    // Mouse события для десктопа
    screen4.addEventListener('mousedown', (e) => {
      if (currentScreen !== 3) return;
      isTouching = true;
      setMaskPosition(e.clientY);
    });

    screen4.addEventListener('mousemove', (e) => {
      if (currentScreen !== 3 || !isTouching) return;
      setMaskPosition(e.clientY);
    });

    screen4.addEventListener('mouseup', () => {
      isTouching = false;
    });

    screen4.addEventListener('mouseleave', () => {
      isTouching = false;
    });

    // Предзагрузка следующей страницы
    const preload = document.createElement('link');
    preload.rel = 'prefetch';
    preload.href = 'quiet.html';
    document.head.appendChild(preload);

    console.log('Battle of Senses - Визуальная ветвь загружена');
    console.log('Экранов:', totalScreens);
  </script>
</body>
</html>
